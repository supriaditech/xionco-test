<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800 pb-20 md:pb-0">
    <%- include('layouts/navbar') %>

    <div class="max-w-6xl mx-auto p-4 md:p-6 space-y-6 pt-6">
      <div>
        <h1 class="text-xl md:text-2xl font-bold text-gray-900">
          Dashboard Overview
        </h1>
        <p class="text-xs md:text-sm text-gray-500">
          Ringkasan performa toko hari ini.
        </p>
      </div>

      <div
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6"
      >
        <div
          class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4"
        >
          <div
            class="p-3 bg-indigo-100 text-indigo-600 rounded-lg text-xl md:text-2xl"
          >
            üí∞
          </div>
          <div class="overflow-hidden">
            <p
              class="text-[10px] md:text-xs font-bold text-gray-500 uppercase truncate"
            >
              Total Pendapatan
            </p>
            <p class="text-lg md:text-xl font-bold text-gray-900 truncate">
              Rp <%= totalRevenue.toLocaleString() %>
            </p>
          </div>
        </div>

        <div
          class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4"
        >
          <div
            class="p-3 bg-emerald-100 text-emerald-600 rounded-lg text-xl md:text-2xl"
          >
            üßæ
          </div>
          <div>
            <p class="text-[10px] md:text-xs font-bold text-gray-500 uppercase">
              Total Transaksi
            </p>
            <p class="text-lg md:text-xl font-bold text-gray-900">
              <%= totalTransactions %> Order
            </p>
          </div>
        </div>

        <div
          class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4"
        >
          <div
            class="p-3 bg-blue-100 text-blue-600 rounded-lg text-xl md:text-2xl"
          >
            üì¶
          </div>
          <div>
            <p class="text-[10px] md:text-xs font-bold text-gray-500 uppercase">
              Jumlah Produk
            </p>
            <p class="text-lg md:text-xl font-bold text-gray-900">
              <%= totalProducts %> Item
            </p>
          </div>
        </div>

        <div
          class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4"
        >
          <div
            class="p-3 bg-red-100 text-red-600 rounded-lg text-xl md:text-2xl"
          >
            ‚ö†Ô∏è
          </div>
          <div>
            <p class="text-[10px] md:text-xs font-bold text-gray-500 uppercase">
              Stok Menipis
            </p>
            <p class="text-lg md:text-xl font-bold text-gray-900">
              <%= lowStockCount %> Item
            </p>
            <% if(lowStockCount > 0) { %>
            <a
              href="/stok"
              class="text-[10px] md:text-xs text-red-500 hover:underline"
              >Cek sekarang &rarr;</a
            >
            <% } %>
          </div>
        </div>
      </div>

      <div
        class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"
      >
        <div
          class="bg-gray-50 px-4 py-3 border-b border-gray-100 flex justify-between items-center"
        >
          <h2 class="font-semibold text-gray-700 text-sm md:text-base">
            üïí Transaksi Terakhir
          </h2>
          <a
            href="/transaction"
            class="text-xs font-semibold text-indigo-600 hover:underline"
            >Lihat Semua</a
          >
        </div>

        <div>
          <table class="w-full text-left table-fixed">
            <thead
              class="bg-gray-50 text-[10px] md:text-xs text-gray-500 uppercase font-semibold"
            >
              <tr>
                <th class="hidden md:table-cell md:w-[20%] px-6 py-3">Waktu</th>
                <th class="w-[50%] md:w-[30%] px-3 py-3 md:px-6">Produk</th>
                <th class="w-[15%] md:w-[15%] px-1 py-3 md:px-6 text-center">
                  Jml
                </th>
                <th class="w-[35%] md:w-[20%] px-2 py-3 md:px-6 text-right">
                  Total
                </th>
                <th
                  class="hidden md:table-cell md:w-[15%] px-6 py-3 text-right"
                >
                  Status
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              <% if(recentPurchases.length === 0) { %>
              <tr>
                <td colspan="5" class="p-6 text-center text-gray-400 text-sm">
                  Belum ada transaksi.
                </td>
              </tr>
              <% } %> <% recentPurchases.forEach(tr => { %>
              <tr class="hover:bg-gray-50 transition">
                <td
                  class="hidden md:table-cell px-6 py-4 text-xs text-gray-500"
                >
                  <%= new Date(tr.createdAt).toLocaleDateString('id-ID') %>
                  <br class="hidden lg:block" />
                  <%= new Date(tr.createdAt).toLocaleTimeString('id-ID', {hour:
                  '2-digit', minute:'2-digit'}) %>
                </td>

                <td class="px-3 py-3 md:px-6 md:py-4 align-middle">
                  <div class="flex flex-col">
                    <span
                      class="text-xs md:text-sm font-medium text-gray-800 break-words leading-tight"
                    >
                      <%= tr.Product ? tr.Product.name : 'Produk Dihapus' %>
                    </span>
                    <span class="md:hidden text-[10px] text-gray-400 mt-1">
                      <%= new Date(tr.createdAt).toLocaleDateString('id-ID',
                      {day: 'numeric', month: 'short'}) %>, <%= new
                      Date(tr.createdAt).toLocaleTimeString('id-ID', {hour:
                      '2-digit', minute:'2-digit'}) %>
                    </span>
                  </div>
                </td>

                <td
                  class="px-1 py-3 md:px-6 md:py-4 text-center text-xs md:text-sm text-gray-600 align-middle"
                >
                  x<%= tr.quantity %>
                </td>

                <td
                  class="px-2 py-3 md:px-6 md:py-4 font-semibold text-emerald-600 text-right align-middle text-xs md:text-sm"
                >
                  <div class="flex flex-col items-end">
                    <span>Rp <%= tr.totalPrice.toLocaleString() %></span>
                  </div>
                </td>

                <td
                  class="hidden md:table-cell px-6 py-4 text-right align-middle"
                >
                  <span
                    class="inline-block px-2 py-1 text-[10px] font-bold bg-green-100 text-green-700 rounded"
                  >
                    Selesai
                  </span>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
